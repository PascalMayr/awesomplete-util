// AwesompleteUtil - Nico Hoogervorst - MIT license
var AwesompleteUtil=function(){function t(t){var e=Array.isArray(t)?{label:t[0],value:t[1]}:"object"==typeof t&&"label"in t&&"value"in t?t:{label:t,value:t};return{label:e.label||e.value,value:e.value}}function e(t,e,r){return F.fire(t,e,{detail:r})}function r(r,n){var i,l,a,u,o=r.input,s=r.utilprops,p=s.selected,c=s.convertInput(o.value),v=r.opened,d=[],f=r._list;if(s.prepop=!1,f){for(u=0;u<f.length;u++)if(a=f[u],i=t(r.data(a,c)),0===r.maxItems&&r.filter(i,c)&&(v=!0),l={input:{value:""}},r.replace.call(l,i),s.convertInput(l.input.value)===c){if(p&&p.value===i.value&&p.label===i.label){d=[a];break}d.push(a)}s.prevSelected!==d&&(d.length>0?n?e(o,E,d):s.changed&&(s.prevSelected=d,o.classList.remove(x),o.classList.add(k),e(o,C,d)):n?e(o,E,[]):s.changed&&(s.prevSelected=[],o.classList.remove(k),v&&o===document.activeElement?o.classList.remove(x):c.length>0&&(o.classList.add(x),e(o,C,[]))))}}function n(t){var e=this;t.type!==w&&t.type!==A&&"blur"!=t.type||t.target!==e.input||r(e,e.utilprops.prepop&&t.type===A)}function i(t){var e=this;t.target===e.input&&9===t.keyCode&&e.select()}function l(t){var e=this;e.utilprops.changed=!0,e.utilprops.selected=t.text}function a(t){return 0===Object.keys(t).length&&t.constructor===Object}function u(t,e,r){var n=t.utilprops;return!n.listQuery||!n.loadall&&0===e.lastIndexOf(r,0)&&(0!==e.lastIndexOf(n.listQuery,0)||n.limit>1&&t._list.length>=n.limit)}function o(){var t,r,n=this,i=n.w,l=n.xhr,o=n.queryParam,s=i.utilprops.val;if(200===l.status){if(t=JSON.parse(l.responseText),i.utilprops.convertResponse&&(t=i.utilprops.convertResponse(t)),!Array.isArray(t))for(r in t)if(Array.isArray(t[r])){t=t[r];break}Array.isArray(t)||1!==i.utilprops.limit||(t=a(t)?[]:[t]),Array.isArray(t)&&u(i,s,o)&&(i.list=t,i.utilprops.listQuery=o||i.utilprops.loadall,e(i.input,A,o))}}function s(t,e){var n;t.utilprops.url&&u(t,e,e)?(n=new XMLHttpRequest,t.utilprops.ajax(t.utilprops.url,t.utilprops.urlEnd,t.utilprops.loadall?"":e,o.bind({w:t,xhr:n,queryParam:e}),n)):r(t,t.utilprops.prepop)}function p(t){var r=t.input;r.classList.remove(x,k),e(r,C,[])}function c(t,e,r){return t.utilprops.prepop=r||!1,t.utilprops.val!==e&&(t.utilprops.selected=null,t.utilprops.changed=!0,t.utilprops.val=e,(e.length<t.minChars||0==e.length)&&p(t),e.length<t.minChars||s(t,e)),t}function v(t){var e,r=this;t.target===r.input&&(e=r.utilprops.convertInput(r.input.value),c(r,e))}function d(t){return F.create("li",{innerHTML:t,"aria-selected":"false"})}function f(t){return t.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}function h(t){var e,r,n=this,i=n.s,l=n.z,a=n.b;t.target===F(i)&&("function"==typeof a?a(t,l):(e=F(a),e&&e!==document.activeElement&&(r=Array.isArray(t.detail)&&1===t.detail.length?t.detail[0]:null,r=(l&&r?r[l]:r)||"",void 0!==e.value?(e.value=r,e.classList&&e.classList.remove&&e.classList.remove(x)):void 0!==e.src?e.src=r:e.innerHTML=r)))}function m(t){var e,r=this;t.target===F(r.btnId)&&(e=r.w,0===e.ul.childNodes.length?(e.minChars=0,e.evaluate()):e.ul.hasAttribute("hidden")?e.open():e.close())}function b(t,e,r){var n=F.regExpEscape(f(e).trim()),i=n.length>0?r?RegExp("^"+n,"i"):RegExp("(?!<[^>]+?>)"+n+"(?![^<]*?>)","gi"):null;return t.replace(i,"<mark>$&</mark>")}function y(t,e,r,n,i){var l,a=i.root,u=i.value,o=i.label||i.value,s=!0,p=[];if(0===n&&a&&r&&0!==(r+".").lastIndexOf(a+".",0)&&0!==(a+".").lastIndexOf(r+".",0))return t;if(Object(e)!==e)r?t[r]=e:t=e;else if(Array.isArray(e)){for(l=0;l<e.length;l++)p.push(y({},e[l],"",n+1,i));r?t[r]=p:t=p}else{for(l in e)s=!1,y(t,e[l],r?r+"."+l:l,n,i);s&&r&&(t[r]={})}return 2>n&&r&&(u&&0===(r+".").lastIndexOf(u+".",0)&&(t.value=t[r]),o&&0===(r+".").lastIndexOf(o+".",0)&&(t.label=t[r])),t}function g(){var t=this,e=t.w.input,r=t.bm,n=t.bi,i=t.bk,l=t.bs;e.removeEventListener(I,l),e.removeEventListener(A,r),e.removeEventListener(w,r),e.removeEventListener("blur",r),e.removeEventListener("input",n),e.removeEventListener("keydown",i)}var L="awesomplete-",A=L+"loadcomplete",w=L+"close",C=L+"match",E=L+"prepop",I=L+"select",k="awe-found",x="awe-not-found",F=Awesomplete.$;return{ajax:function(t,e,r,n,i){return i=i||new XMLHttpRequest,i.open("GET",t+encodeURIComponent(r)+(e||"")),i.onload=n,i.send(),i},convertInput:function(t){return"string"==typeof t?t.trim().toLowerCase():""},item:d,mark:b,itemContains:function(t,e){var r;return e.trim().length>0&&(r=(""+t).split(/<p>/),r[0]=b(r[0],e),t=r.join("<p>")),d(t,e)},itemStartsWith:function(t,e){return d(""===e.trim()?""+t:b(""+t,e,!0),e)},createAwesomplete:function(t,e,r){r.item=r.item||this.itemContains;var n=new Awesomplete(t,r);return n.utilprops=e||{},n.utilprops.url||void 0!==n.utilprops.loadall||(n.utilprops.loadall=!0),n.utilprops.ajax=n.utilprops.ajax||this.ajax,n.utilprops.convertInput=n.utilprops.convertInput||this.convertInput,n},attach:function(t){var e=t.input,r=n.bind(t),a=i.bind(t),u=v.bind(t),o=l.bind(t),p=g.bind({w:t,bm:r,bi:u,bk:a,bs:o}),c={keydown:a,input:u};return c.blur=c[w]=c[A]=r,c[I]=o,F.bind(e,c),t.utilprops.detach=p,t.utilprops.prepop&&(t.utilprops.loadall||e.value.length>0)&&(t.utilprops.val=t.utilprops.convertInput(e.value),s(t,t.utilprops.val)),t},update:function(t,e,r){return t.input.value=e,c(t,e,r)},startAwesomplete:function(t,e,r){return this.attach(this.createAwesomplete(t,e,r))},detach:function(t){return t.utilprops.detach&&(t.utilprops.detach(),delete t.utilprops.detach),t},createCopyFun:function(t,e,r){return h.bind({s:F(t)||t,z:e,b:F(r)||r})},attachCopyFun:function(t,e){return e="boolean"==typeof e?e:!0,addEventListener(C,t),e&&addEventListener(E,t),t},startCopy:function(t,e,r,n){return this.attachCopyFun(this.createCopyFun(t,e,r),n)},detachCopyFun:function(t){return removeEventListener(E,t),removeEventListener(C,t),t},createClickFun:function(t,e){return m.bind({btnId:F(t)||t,w:e})},attachClickFun:function(t){return addEventListener("click",t),t},startClick:function(t,e){return this.attachClickFun(this.createClickFun(t,e))},detachClickFun:function(t){return removeEventListener("click",t),t},filterContains:function(t,e){return Awesomplete.FILTER_CONTAINS(t.value,e)},filterStartsWith:function(t,e){return Awesomplete.FILTER_STARTSWITH(t.value,e)},jsonFlatten:function(t){return y({},t,"",0,this)}}}();
